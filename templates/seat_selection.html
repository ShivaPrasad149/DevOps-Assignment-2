<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seat Selection - BusBooker Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body class="bg-background min-h-screen">
    <!-- Header Navigation -->
    <header class="bg-surface shadow-base border-b border-secondary-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <svg class="w-8 h-8 text-primary mr-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                        <path d="M2 4v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2z" fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <h1 class="text-xl font-bold text-text-primary">BusBooker Pro</h1>
                </div>
                
                <!-- Navigation -->
                <nav class="hidden md:flex space-x-8">
                    <a href="{{ url_for('route_search') }}" class="text-text-secondary hover:text-primary transition-smooth">Search Routes</a>
                    <a href="{{ url_for('seat_selection') }}" class="text-primary font-medium">Select Seats</a>
                    <a href="{{ url_for('payment_processing') }}" class="text-text-secondary hover:text-primary transition-smooth">Payment</a>
                </nav>
                
                <!-- Mobile Menu Button -->
                <button class="md:hidden p-2 rounded-md text-text-secondary hover:text-primary hover:bg-secondary-50 transition-smooth">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Trip Details Header -->
        <section class="bg-surface rounded-lg shadow-base border border-secondary-200 p-6 mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <img src="{{ route.image }}" 
                         alt="{{ route.operator }} Bus" 
                         class="w-16 h-12 object-cover rounded-md"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div>
                        <h2 class="text-xl font-bold text-text-primary">{{ route.operator }}</h2>
                        <p class="text-sm text-text-secondary">{{ route.type }} ‚Ä¢ {{ route.seating }}</p>
                        <div class="flex items-center mt-1">
                            <svg class="w-4 h-4 text-accent-500 fill-current" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            <span class="text-sm text-text-secondary ml-1">{{ route.rating }} ({{ route.reviews }} reviews)</span>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-sm text-text-secondary">From</div>
                        <div class="font-semibold text-text-primary">{{ route.from }}</div>
                        <div class="text-sm text-text-secondary">{{ route.departure }}</div>
                    </div>
                    <div>
                        <div class="text-sm text-text-secondary">To</div>
                        <div class="font-semibold text-text-primary">{{ route.to }}</div>
                        <div class="text-sm text-text-secondary">{{ route.arrival }}</div>
                    </div>
                    <div>
                        <div class="text-sm text-text-secondary">Date</div>
                        <div class="font-semibold text-text-primary">{{ route.date }}</div>
                        <div class="text-sm text-text-secondary">{{ route.duration }}</div>
                    </div>
                    <div>
                        <div class="text-sm text-text-secondary">Available</div>
                        <div class="font-semibold text-success-600">{{ route.available_seats }} seats</div>
                        <div class="text-sm text-text-secondary">Total: 36</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Seat Selection Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Seat Map Section -->
            <div class="lg:col-span-2">
                <div class="bg-surface rounded-lg shadow-base border border-secondary-200 p-6">
                    <!-- Seat Map Header -->
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-text-primary flex items-center">
                            <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            Select Your Seats
                        </h3>
                        <div class="flex items-center space-x-4 text-sm">
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-success-500 rounded border"></div>
                                <span class="text-text-secondary">Available</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-primary-600 rounded border"></div>
                                <span class="text-text-secondary">Selected</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-secondary-400 rounded border"></div>
                                <span class="text-text-secondary">Occupied</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bus Layout -->
                    <div class="bg-secondary-50 rounded-lg p-6 overflow-x-auto">
                        <!-- Driver Section -->
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-2">
                                <svg class="w-6 h-6 text-secondary-600" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                <span class="text-sm font-medium text-secondary-600">Driver</span>
                            </div>
                            <div class="text-sm text-text-secondary">Front of Bus</div>
                        </div>

                        <!-- Seat Grid -->
                        <div class="space-y-4" id="seat-map">
                            <!-- Upper Deck -->
                            <div class="bg-surface rounded-lg p-4 border border-secondary-200">
                                <h4 class="text-sm font-medium text-text-primary mb-4 text-center">Upper Deck - Sleeper</h4>
                                <div class="grid grid-cols-3 gap-4 max-w-md mx-auto">
                                    <!-- Row 1 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.upper_deck %}
                                        {% if loop.index0 % 3 == 0 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                    <!-- Aisle -->
                                    <div class="w-4"></div>
                                    <!-- Row 2 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.upper_deck %}
                                        {% if loop.index0 % 3 == 1 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <!-- Lower Deck -->
                            <div class="bg-surface rounded-lg p-4 border border-secondary-200">
                                <h4 class="text-sm font-medium text-text-primary mb-4 text-center">Lower Deck - Semi-Sleeper</h4>
                                <div class="grid grid-cols-5 gap-2 max-w-lg mx-auto">
                                    <!-- Row 1 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.lower_deck %}
                                        {% if loop.index0 % 4 == 0 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                    <!-- Row 2 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.lower_deck %}
                                        {% if loop.index0 % 4 == 1 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                    <!-- Aisle -->
                                    <div class="w-4"></div>
                                    <!-- Row 3 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.lower_deck %}
                                        {% if loop.index0 % 4 == 2 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                    <!-- Row 4 -->
                                    <div class="space-y-2">
                                        {% for seat in seat_layout.lower_deck %}
                                        {% if loop.index0 % 4 == 3 %}
                                        <button class="seat-button {% if seat.available %}seat-available{% else %}seat-occupied{% endif %}" 
                                                data-seat="{{ seat.id }}" 
                                                data-price="{{ seat.price }}" 
                                                data-type="{{ seat.type }}"
                                                {% if not seat.available %}disabled{% endif %}>
                                            <span class="text-xs font-medium">{{ seat.id }}</span>
                                        </button>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bus Rear -->
                        <div class="text-center mt-6">
                            <div class="text-sm text-text-secondary">Rear of Bus</div>
                        </div>
                    </div>

                    <!-- Seat Selection Actions -->
                    <div class="flex items-center justify-between mt-6 pt-6 border-t border-secondary-200">
                        <div class="text-sm text-text-secondary">
                            <span id="selected-count">0</span> seat(s) selected
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="clearSelection()" class="btn-secondary text-sm">Clear Selection</button>
                            <button onclick="autoSelectBest()" class="btn-secondary text-sm">Auto Select Best</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Summary & Passenger Details -->
            <div class="space-y-6">
                <!-- Booking Summary -->
                <div class="bg-surface rounded-lg shadow-base border border-secondary-200 p-6">
                    <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                        <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Booking Summary
                    </h3>

                    <!-- Selected Seats -->
                    <div class="space-y-3 mb-6">
                        <div class="text-sm font-medium text-text-primary">Selected Seats</div>
                        <div id="selected-seats-list" class="text-sm text-text-secondary">
                            No seats selected
                        </div>
                    </div>

                    <!-- Fare Breakdown -->
                    <div class="space-y-3 border-t border-secondary-200 pt-4">
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Base Fare</span>
                            <span class="text-text-primary" id="base-fare">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Service Tax (5%)</span>
                            <span class="text-text-primary" id="service-tax">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-text-secondary">Booking Fee</span>
                            <span class="text-text-primary">$2.50</span>
                        </div>
                        <div class="flex justify-between text-sm text-success-600">
                            <span>Discount (Early Bird)</span>
                            <span id="discount">-$0.00</span>
                        </div>
                        <div class="border-t border-secondary-200 pt-3">
                            <div class="flex justify-between font-semibold text-lg">
                                <span class="text-text-primary">Total Amount</span>
                                <span class="text-primary" id="total-amount">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Passenger Information -->
                <div class="bg-surface rounded-lg shadow-base border border-secondary-200 p-6">
                    <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                        <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        Passenger Details
                    </h3>

                    <div id="passenger-forms" class="space-y-6">
                        <!-- Passenger forms will be dynamically generated -->
                    </div>

                    <!-- Contact Information -->
                    <div class="border-t border-secondary-200 pt-6 mt-6">
                        <h4 class="text-md font-medium text-text-primary mb-4">Contact Information</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label for="contact-email" class="block text-sm font-medium text-text-secondary mb-2">Email Address *</label>
                                <input type="email" id="contact-email" class="form-input" placeholder="john.doe@example.com" required>
                            </div>
                            <div>
                                <label for="contact-phone" class="block text-sm font-medium text-text-secondary mb-2">Phone Number *</label>
                                <input type="tel" id="contact-phone" class="form-input" placeholder="+1 (555) 123-4567" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="space-y-3">
                    <button onclick="proceedToPayment()" id="proceed-btn" class="w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Proceed to Payment
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                    <a href="{{ url_for('route_search') }}" class="w-full btn-secondary text-center block">
                        <svg class="w-4 h-4 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        Modify Selection
                    </a>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-secondary-800 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <svg class="w-8 h-8 text-primary mr-3" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"/>
                            <path d="M2 4v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <h3 class="text-xl font-bold">BusBooker Pro</h3>
                    </div>
                    <p class="text-secondary-300 text-sm">Your trusted partner for comfortable and affordable bus travel across the country.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm text-secondary-300">
                        <li><a href="{{ url_for('route_search') }}" class="hover:text-white transition-smooth">Search Routes</a></li>
                        <li><a href="{{ url_for('seat_selection') }}" class="hover:text-white transition-smooth">Book Tickets</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Track Bus</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Cancel Booking</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-sm text-secondary-300">
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Help Center</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Contact Us</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Terms & Conditions</a></li>
                        <li><a href="javascript:void(0)" class="hover:text-white transition-smooth">Privacy Policy</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Contact Info</h4>
                    <div class="space-y-2 text-sm text-secondary-300">
                        <p>üìû 1-800-BUS-BOOK</p>
                        <p>‚úâÔ∏è support@busbookerpro.com</p>
                        <p>üïí 24/7 Customer Support</p>
                    </div>
                </div>
            </div>
            <div class="border-t border-secondary-700 mt-8 pt-8 text-center text-sm text-secondary-300">
                <p>¬© 2025 BusBooker Pro. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Global variables
        let selectedSeats = [];
        let passengerCount = 0;

        // Seat selection functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeSeatSelection();
        });

        function initializeSeatSelection() {
            const seatButtons = document.querySelectorAll('.seat-button:not([disabled])');
            
            seatButtons.forEach(button => {
                button.addEventListener('click', function() {
                    toggleSeatSelection(this);
                });
            });
        }

        function toggleSeatSelection(seatButton) {
            const seatId = seatButton.dataset.seat;
            const seatPrice = parseFloat(seatButton.dataset.price);
            const seatType = seatButton.dataset.type;

            if (seatButton.classList.contains('seat-selected')) {
                // Deselect seat
                seatButton.classList.remove('seat-selected');
                seatButton.classList.add('seat-available');
                
                selectedSeats = selectedSeats.filter(seat => seat.id !== seatId);
            } else {
                // Select seat (limit to 6 seats)
                if (selectedSeats.length >= 6) {
                    alert('Maximum 6 seats can be selected at once.');
                    return;
                }
                
                seatButton.classList.remove('seat-available');
                seatButton.classList.add('seat-selected');
                
                selectedSeats.push({
                    id: seatId,
                    price: seatPrice,
                    type: seatType
                });
            }

            updateBookingSummary();
            updatePassengerForms();
            updateProceedButton();
        }

        function updateBookingSummary() {
            const selectedCount = selectedSeats.length;
            document.getElementById('selected-count').textContent = selectedCount;

            // Update selected seats list
            const seatsList = document.getElementById('selected-seats-list');
            if (selectedCount === 0) {
                seatsList.textContent = 'No seats selected';
            } else {
                const seatsText = selectedSeats.map(seat => `${seat.id} (${seat.type})`).join(', ');
                seatsList.textContent = seatsText;
            }

            // Calculate fare breakdown
            const baseFare = selectedSeats.reduce((total, seat) => total + seat.price, 0);
            const serviceTax = baseFare * 0.05;
            const bookingFee = selectedCount > 0 ? 2.50 : 0;
            const discount = baseFare > 100 ? baseFare * 0.1 : 0; // 10% discount for bookings over $100
            const totalAmount = baseFare + serviceTax + bookingFee - discount;

            document.getElementById('base-fare').textContent = `$${baseFare.toFixed(2)}`;
            document.getElementById('service-tax').textContent = `$${serviceTax.toFixed(2)}`;
            document.getElementById('discount').textContent = `-$${discount.toFixed(2)}`;
            document.getElementById('total-amount').textContent = `$${totalAmount.toFixed(2)}`;
        }

        function updatePassengerForms() {
            const passengerFormsContainer = document.getElementById('passenger-forms');
            const currentPassengerCount = selectedSeats.length;

            // Clear existing forms
            passengerFormsContainer.innerHTML = '';

            if (currentPassengerCount === 0) {
                passengerFormsContainer.innerHTML = '<p class="text-sm text-text-secondary">Select seats to add passenger details</p>';
                return;
            }

            // Generate passenger forms
            for (let i = 0; i < currentPassengerCount; i++) {
                const seat = selectedSeats[i];
                const passengerForm = createPassengerForm(i + 1, seat);
                passengerFormsContainer.appendChild(passengerForm);
            }

            passengerCount = currentPassengerCount;
        }

        function createPassengerForm(passengerNumber, seat) {
            const formDiv = document.createElement('div');
            formDiv.className = 'border border-secondary-200 rounded-lg p-4';
            
            formDiv.innerHTML = `
                <h5 class="text-sm font-medium text-text-primary mb-3">
                    Passenger ${passengerNumber} - Seat ${seat.id}
                    <span class="text-xs text-text-secondary ml-2">(${seat.type})</span>
                </h5>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-text-secondary mb-2">Full Name *</label>
                        <input type="text" class="form-input passenger-name" placeholder="John Doe" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-secondary mb-2">Age *</label>
                        <input type="number" class="form-input passenger-age" placeholder="25" min="1" max="120" required>
                    </div>
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-medium text-text-secondary mb-2">Gender *</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="gender-${passengerNumber}" value="male" class="text-primary focus:ring-primary-500" required>
                                <span class="ml-2 text-sm text-text-secondary">Male</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="gender-${passengerNumber}" value="female" class="text-primary focus:ring-primary-500" required>
                                <span class="ml-2 text-sm text-text-secondary">Female</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="gender-${passengerNumber}" value="other" class="text-primary focus:ring-primary-500" required>
                                <span class="ml-2 text-sm text-text-secondary">Other</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;

            return formDiv;
        }

        function updateProceedButton() {
            const proceedBtn = document.getElementById('proceed-btn');
            const hasSelectedSeats = selectedSeats.length > 0;
            
            if (hasSelectedSeats) {
                proceedBtn.disabled = false;
                proceedBtn.classList.remove('disabled:opacity-50', 'disabled:cursor-not-allowed');
            } else {
                proceedBtn.disabled = true;
                proceedBtn.classList.add('disabled:opacity-50', 'disabled:cursor-not-allowed');
            }
        }

        function clearSelection() {
            // Clear all selected seats
            const selectedSeatButtons = document.querySelectorAll('.seat-selected');
            selectedSeatButtons.forEach(button => {
                button.classList.remove('seat-selected');
                button.classList.add('seat-available');
            });

            selectedSeats = [];
            updateBookingSummary();
            updatePassengerForms();
            updateProceedButton();
        }

        function autoSelectBest() {
            // Clear current selection
            clearSelection();

            // Find best available seats (consecutive if possible)
            const availableSeats = document.querySelectorAll('.seat-available');
            const seatsToSelect = Math.min(2, availableSeats.length); // Auto-select 2 seats

            for (let i = 0; i < seatsToSelect; i++) {
                toggleSeatSelection(availableSeats[i]);
            }
        }

        function proceedToPayment() {
            // Validate passenger information
            if (!validatePassengerInfo()) {
                return;
            }

            // Store booking data in sessionStorage
            const bookingData = {
                selectedSeats: selectedSeats,
                passengerInfo: collectPassengerInfo(),
                contactInfo: {
                    email: document.getElementById('contact-email').value,
                    phone: document.getElementById('contact-phone').value
                },
                totalAmount: document.getElementById('total-amount').textContent,
                busInfo: {
                    operator: '{{ route.operator }}',
                    route: '{{ route.from }} to {{ route.to }}',
                    date: '{{ route.date }}',
                    time: '{{ route.departure }} - {{ route.arrival }}'
                }
            };

            sessionStorage.setItem('bookingData', JSON.stringify(bookingData));
            
            // Navigate to payment page
            window.location.href = "{{ url_for('payment_processing') }}";
        }

        function validatePassengerInfo() {
            const nameInputs = document.querySelectorAll('.passenger-name');
            const ageInputs = document.querySelectorAll('.passenger-age');
            const genderInputs = document.querySelectorAll('input[type="radio"]:checked');
            const emailInput = document.getElementById('contact-email');
            const phoneInput = document.getElementById('contact-phone');

            // Check if all passenger names are filled
            for (let input of nameInputs) {
                if (!input.value.trim()) {
                    alert('Please fill in all passenger names.');
                    input.focus();
                    return false;
                }
            }

            // Check if all ages are filled and valid
            for (let input of ageInputs) {
                if (!input.value || input.value < 1 || input.value > 120) {
                    alert('Please enter valid ages for all passengers.');
                    input.focus();
                    return false;
                }
            }

            // Check if gender is selected for all passengers
            if (genderInputs.length !== selectedSeats.length) {
                alert('Please select gender for all passengers.');
                return false;
            }

            // Check contact information
            if (!emailInput.value.trim() || !isValidEmail(emailInput.value)) {
                alert('Please enter a valid email address.');
                emailInput.focus();
                return false;
            }

            if (!phoneInput.value.trim()) {
                alert('Please enter a phone number.');
                phoneInput.focus();
                return false;
            }

            return true;
        }

        function collectPassengerInfo() {
            const passengers = [];
            const nameInputs = document.querySelectorAll('.passenger-name');
            const ageInputs = document.querySelectorAll('.passenger-age');
            
            for (let i = 0; i < selectedSeats.length; i++) {
                const genderInput = document.querySelector(`input[name="gender-${i + 1}"]:checked`);
                passengers.push({
                    seatId: selectedSeats[i].id,
                    name: nameInputs[i].value.trim(),
                    age: parseInt(ageInputs[i].value),
                    gender: genderInput ? genderInput.value : ''
                });
            }

            return passengers;
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Real-time seat availability simulation
        function simulateRealTimeUpdates() {
            setInterval(() => {
                // Randomly make some available seats occupied (simulate other bookings)
                const availableSeats = document.querySelectorAll('.seat-available');
                if (availableSeats.length > 0 && Math.random() < 0.1) { // 10% chance every 30 seconds
                    const randomSeat = availableSeats[Math.floor(Math.random() * availableSeats.length)];
                    randomSeat.classList.remove('seat-available');
                    randomSeat.classList.add('seat-occupied');
                    randomSeat.disabled = true;
                }
            }, 30000); // Check every 30 seconds
        }

        // Initialize real-time updates
        simulateRealTimeUpdates();

        // Mobile touch enhancements
        if ('ontouchstart' in window) {
            document.querySelectorAll('.seat-button').forEach(button => {
                button.style.minWidth = '44px';
                button.style.minHeight = '44px';
            });
        }
    </script>
</body>
</html>